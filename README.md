# AI Therapist Agent

Мультиагентная система для терапевтических бесед на основе LangGraph с поддержкой различных терапевтических подходов.

⚠️ **Образовательная демонстрация - не для реального терапевтического использования**

## Терапевтические подходы

- **DBT (Диалектическая поведенческая терапия)** - эмоциональная регуляция, толерантность к дистрессу
- **IFS (Терапия внутренних семейных систем)** - работа с внутренними частями личности
- **TRE (Упражнения для высвобождения травмы)** - телесная осознанность и работа с травмой

## Архитектура

Система использует LangGraph для маршрутизации между специализированными агентами:

```
Пользователь → Router Agent → [DBT/IFS/TRE Agent] → Memory Agent → Ответ
```

## Структура проекта

```
ai_therapist/
├── agents/
│   ├── __init__.py
│   ├── base.py          # Базовые классы и типы
│   ├── prompts.py       # Промпты для агентов
│   └── specialists.py   # Специализированные агенты
├── core/
│   ├── __init__.py
│   ├── graph.py         # LangGraph граф обработки
│   ├── storage.py       # SQLite хранилище сессий
│   └── orchestrator.py  # Главный оркестратор
├── config.py            # Конфигурация
├── requirements.txt     # Зависимости
├── .env.example        # Пример настроек окружения
├── main.py             # CLI интерфейс
├── app.py              # Streamlit веб-интерфейс
└── therapy-agents-python.py  # Исходный код (для справки)
```

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd ai_therapist
```

2. Установите зависимости через [uv](https://docs.astral.sh/uv/):
```bash
uv sync
```

3. Настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env файл, добавив свои API ключи
```

## Использование

### CLI интерфейс

```bash
uv run python main.py
```

### Веб-интерфейс (Streamlit)

```bash
uv run streamlit run app.py
```

## Поддерживаемые модели

Система использует LiteLLM и поддерживает множество провайдеров:

- **OpenAI**: `gpt-4`, `gpt-3.5-turbo`
- **Anthropic**: `claude-3-haiku-20240307`, `claude-3-sonnet-20240229`
- **Google**: `gemini-pro`
- **Ollama**: `ollama/llama2`, `ollama/mistral`
- **YandexGPT**: `yandexgpt/latest`
- **Azure OpenAI**: `azure/gpt-4`

## Конфигурация

Отредактируйте `.env` файл:

```env
MODEL=gpt-4
OPENAI_API_KEY=your-key-here
```

### Google Sheets для промптов

1. Создайте Google-таблицу с колонками `key`, `prompt`, `updated_at`, `updated_by` и заполните строки для `router`, `dbt`, `ifs`, `tre`, `memory` (см. значения в `agents/prompts.py`).
2. Создайте сервисный аккаунт в Google Cloud, скачайте JSON-ключ, включите **Google Sheets API** (и при необходимости Google Drive API) для проекта и дайте аккаунту доступ **Editor** к таблице.
3. Скопируйте файл `.streamlit/secrets.example.toml` в `.streamlit/secrets.toml` и вставьте туда URL таблицы и значения из JSON-ключа (сохраняйте переносы строк в `private_key`).
4. Установите зависимости и запустите приложение локально: `uv sync && uv run streamlit run app.py`.
5. В боковой панели появится редактор промптов; изменения сохраняются в таблицу и видны всем пользователям.

## Особенности

- **Автоматическая маршрутизация** к подходящему терапевтическому агенту
- **Память сессии** с SQLite базой данных
- **Извлечение инсайтов** из разговоров
- **Два интерфейса**: CLI и веб
- **Поддержка множества LLM** через LiteLLM

## Безопасность

Это образовательный проект для демонстрации мультиагентных систем. Не используйте для реальной терапии без надлежащего профессионального надзора.

## Лицензия

MIT
